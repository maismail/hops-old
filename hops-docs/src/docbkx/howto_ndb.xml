<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0" xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:ns5="http://www.w3.org/2000/svg"
         xmlns:ns4="http://www.w3.org/1998/Math/MathML"
         xmlns:ns3="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Configuring MySQL NDB Cluster</title>

  <para>MySQL NDB Cluster enables users to meet the database challenges of next generation web, cloud, and communications services with uncompromising scalability, uptime and agility. [1]
    It provides auto-sharding for write-scalability, real time performance, SQL and NoSQL APIs and 99.999% availability</para>
  
  <section>
    <title>MySQL Cluster Setup Recommendations</title>
    <para>For higher performance and availability we recommend following NDB Cluster setup.</para>
    <itemizedlist>
      <listitem>
        <para>
          <emphasis> Replication:</emphasis> 
          Although it is possible to setup the MySQL NDB Cluster with replication level set to 1, we strongly recommend to use replication level of 2 or higher. 
        </para>
      </listitem>  
      
      <listitem>
        <para>
          <emphasis>Redundancy of MySQL Servers:</emphasis> 
          For performance reasons aggregate queries are passed down to the MySQL Server. We recommend two or higher number of MySQL servers in the system. 
        </para>
      </listitem>  
      
      
      <listitem>
        <para>
          <emphasis>Number of datanodes:</emphasis> 
          Number of datanodes in the MySQL cluster depends on two factors. 1) Amount of available RAM and  2) Amount of metadata.
          MySQL is in-memory database. For large filesystem metadata, we must add more memory or new datanodes to the NDB Cluster. 
          Currently in HOP an inode (file/directory) takes 450 bytes, and a block with 3 replicas takes up to 500 bytes. In HDFS default block size is 64 MB.  
          If on average all files in the file system consist of 100 blocks, then MySQL Cluster capable of storing 100 GB of data can store metadata for HDFS Cluster of 125 PB.
          These calculation do not take into account space required to store intermediate data for each inode, table indexes, 
          and space required to store housekeeping data such as replication monitor and lease manager data. 
        </para>
      </listitem> 
    </itemizedlist>
  </section>
  
  <section>
    <title>Some Useful MySQL NDB Parameters</title>
    <itemizedlist>
      <listitem>
        <para>
          <emphasis>TransactionInactiveTimeout:</emphasis> 
          In HOP parent directory is locked before a mutation a applied to a file. 
          Upon successful application of the mutation the locks are released.
          In scenarios where hundreds of clients are writing to same directory some thread will 
          starve as they will not be able to acquire lock on the parent directory in ‘TransactionInactiveTimeout’ seconds. 
          In such scenarios is it recommended to increase the value of ‘TransactionInactiveTimeout’ parameter. 
          However this  situation can also be handled by increasing the transaction retry counter as described in the previous section. 
        </para>
      </listitem>  
    </itemizedlist>
  </section>

</section>
